<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë„ì „ ì¹´ë“œ ë½‘ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #111;
      color: #fff;
      font-family: system-ui, -apple-system, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* 3ì—´: ì™¼ìª½ ì ìˆ˜íŒ / ê°€ìš´ë° ë©”ì¸ / ì˜¤ë¥¸ìª½ ì¹´ë“œí˜„í™© */
    .wrap {
      width: 100%;
      max-width: 1060px;
      padding: 18px;
      display: grid;
      grid-template-columns: 260px 1fr 280px;
      gap: 14px;
      align-items: start;
    }

    .panel {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      padding: 14px;
      height: fit-content;
    }

    .app {
      width: 100%;
      max-width: 520px;
      margin: 0 auto;
      padding: 18px;
      text-align: center;
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
    }

    h1 { font-size: 22px; margin: 6px 0 10px; }

    #timer {
      font-size: 22px;
      font-weight: 800;
      margin-bottom: 10px;
      height: 28px;
      color: #f1c40f;
      text-shadow: 0 0 6px rgba(241, 196, 15, 0.5);
    }

    .slot {
      position: relative;
      height: 150px;
      overflow: hidden;
      border-radius: 14px;
      background: #1c1c1c;
      margin: 14px 0 14px;
    }

    .reel {
      position: absolute;
      top: 0;
      width: 100%;
      text-align: center;
      transform: translateY(0px);
    }

    .item {
      height: 50px;
      line-height: 50px;
      font-size: 24px;
      font-weight: 800;
      padding: 0 10px;
      box-sizing: border-box;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .selector {
      position: absolute;
      top: 50px;
      height: 50px;
      width: 100%;
      border-top: 2px solid #e63946;
      border-bottom: 2px solid #e63946;
      pointer-events: none;
    }

    #desc {
      margin-top: 8px;
      padding: 12px;
      border-radius: 12px;
      background: #222;
      font-size: 15px;
      line-height: 1.6;
      display: none;
      text-align: left;
      white-space: pre-line;
    }

    .btn {
      width: 100%;
      font-size: 18px;
      padding: 14px;
      margin: 8px 0;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      color: #fff;
      font-weight: 800;
    }
    .start { background: #2d6cdf; }
    .pick  { background: #e63946; }
    .stop  { background: #f1c40f; color:#111; }
    .end   { background: #444; }
    .mute  { background: #333; font-weight: 700; }

    .small {
      font-size: 13px;
      opacity: 0.85;
      margin-top: 8px;
    }
    .ghost { visibility: hidden; }

    /* íŒ¨ë„ íƒ€ì´í‹€ */
    .panel h2 {
      font-size: 15px;
      margin: 2px 0 10px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* ì˜¤ë¥¸ìª½: ë½‘íŒ ì¹´ë“œ */
    .pickedList {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .pickedItem {
      background: #1b1b1b;
      border-radius: 12px;
      padding: 10px;
      cursor: pointer;
      user-select: none;
    }
    .pickedTitle {
      font-size: 14px;
      font-weight: 800;
      opacity: 0.95;
    }
    .pickedDesc {
      display: none;
      margin-top: 8px;
      font-size: 13px;
      line-height: 1.55;
      opacity: 0.92;
      white-space: pre-line;
    }

    /* ì™¼ìª½: ì ìˆ˜íŒ */
    .scoreHint { font-size: 12px; opacity: 0.75; margin-bottom: 10px; line-height: 1.4; }

    .scoreRows {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .scoreRow {
      display: grid;
      grid-template-columns: 1fr 70px 32px;
      gap: 8px;
      align-items: center;
      background: #1b1b1b;
      border-radius: 12px;
      padding: 10px;
    }
    .scoreRow input {
      width: 100%;
      border: none;
      outline: none;
      border-radius: 10px;
      padding: 10px 10px;
      background: #141414;
      color: #fff;
      font-size: 13px;
      box-sizing: border-box;
    }
    .scoreRow input[type="number"] {
      text-align: center;
    }
    .delBtn {
      width: 32px;
      height: 38px;
      border: none;
      border-radius: 10px;
      background: #2a2a2a;
      color: #fff;
      cursor: pointer;
      font-weight: 900;
    }
    .addRowBtn {
      width: 100%;
      border: none;
      border-radius: 12px;
      padding: 12px;
      background: #2a2a2a;
      color: #fff;
      cursor: pointer;
      font-weight: 800;
      margin-top: 10px;
    }

    .sortedView {
      margin-top: 12px;
      background: #1b1b1b;
      border-radius: 12px;
      padding: 10px;
    }
    .sortedViewTitle {
      font-size: 13px;
      font-weight: 800;
      opacity: 0.9;
      margin-bottom: 6px;
    }
    .sortedList {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
      opacity: 0.95;
    }
    .sortedItem {
      display: flex;
      justify-content: space-between;
      background: #141414;
      border-radius: 10px;
      padding: 8px 10px;
    }
    .sortedName { font-weight: 800; }
    .sortedScore { opacity: 0.9; }

    /* ì„±ê³µ/ì‹¤íŒ¨ ì¹´ìš´í„° */
    .counterBox {
      margin-top: 12px;
      background: #1b1b1b;
      border-radius: 12px;
      padding: 10px;
    }
    .counterRow {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      gap: 8px;
      align-items: center;
      margin-top: 10px;
      background: #141414;
      border-radius: 10px;
      padding: 10px;
    }
    .counterLabel { font-weight: 900; font-size: 13px; }
    .counterValue { font-weight: 900; font-size: 14px; opacity: 0.95; min-width: 22px; text-align:center; }
    .miniBtn {
      width: 34px;
      height: 34px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 900;
      background: #2a2a2a;
      color: #fff;
    }
    .miniBtn.plus { background: #2d6cdf; }
    .miniBtn.minus { background: #444; }

    @media (max-width: 980px) {
      .wrap { grid-template-columns: 1fr; }
      .panel.left { order: 2; }
      .app { order: 1; }
      .panel.right { order: 3; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- ì™¼ìª½: íŠ¸ë¡¤ ì ìˆ˜ + ì„±ê³µ/ì‹¤íŒ¨ -->
    <div class="panel left">
      <h2>ğŸ“Š íŠ¸ë¡¤ ì ìˆ˜</h2>
      <div class="scoreHint">
        ì´ë¦„/ì ìˆ˜ëŠ” ì—¬ê¸°ì„œ ë°”ë¡œ ìˆ˜ì • ê°€ëŠ¥<br>
        ì•„ë˜ "ì •ë ¬ í˜„í™©"ì€ ì ìˆ˜ ë†’ì€ ìˆœìœ¼ë¡œ ìë™ í‘œì‹œë¨
      </div>

      <div class="scoreRows" id="scoreRows"></div>
      <button class="addRowBtn" onclick="addScoreRow()">+ ì¸ì› ì¶”ê°€</button>

      <div class="sortedView">
        <div class="sortedViewTitle">ì •ë ¬ í˜„í™© (ì ìˆ˜ ë†’ì€ ìˆœ)</div>
        <div class="sortedList" id="sortedList"></div>
      </div>

      <div class="counterBox">
        <div class="sortedViewTitle">ì„±ê³µ / ì‹¤íŒ¨ í˜„í™©</div>

        <div class="counterRow">
          <div class="counterLabel">ì„±ê³µ</div>
          <button class="miniBtn minus" onclick="incCounter('success', -1)">-</button>
          <div class="counterValue" id="successVal">0</div>
          <button class="miniBtn plus" onclick="incCounter('success', 1)">+</button>
        </div>

        <div class="counterRow">
          <div class="counterLabel">ì‹¤íŒ¨</div>
          <button class="miniBtn minus" onclick="incCounter('fail', -1)">-</button>
          <div class="counterValue" id="failVal">0</div>
          <button class="miniBtn plus" onclick="incCounter('fail', 1)">+</button>
        </div>
      </div>
    </div>

    <!-- ê°€ìš´ë°: ë©”ì¸ -->
    <div class="app">
      <h1>ğŸƒ ë„ì „ ì¹´ë“œ ë½‘ê¸°</h1>
      <div id="timer"></div>

      <div class="slot">
        <div class="reel" id="reel"></div>
        <div class="selector"></div>
      </div>

      <div id="desc"></div>

      <button class="btn start" onclick="startGame()">ê²Œì„ ì‹œì‘(í´ë¦­X)</button>
      <button class="btn pick"  onclick="startSpin()">ì¹´ë“œ ë½‘ê¸°(ëŒë¦¬ê¸°)</button>
      <button class="btn stop"  onclick="stopSpin()">ìŠ¤íƒ‘(ì„ íƒ)</button>
      <button class="btn mute"  onclick="toggleSound()" id="soundBtn">ğŸ”Š ì‚¬ìš´ë“œ ON</button>
      <button class="btn end"   onclick="endGame()">ê²Œì„ ì¢…ë£Œ(í´ë¦­X)</button>

      <div class="small" id="remain"></div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ë½‘íŒ ì¹´ë“œ í˜„í™© -->
    <div class="panel right">
      <h2>ğŸ“Œ í˜„ì¬ ë½‘íŒ ì¹´ë“œ</h2>
      <div class="pickedList" id="pickedList"></div>
    </div>
  </div>

  <script>
    // ===== ì¹´ë“œ ëª©ë¡ =====
    const CARDS = [
      "ë ˆì´ì € íŠ¸ë¦½ì™€ì´ì–´",
      "ë§ˆìŠ¤í„° í‚¤",
      "ëª¨ì…˜ ê°ì§€ê¸°",
      "ë¶ˆì²­ê° 2",
      "ì§€ë¬¸ ìŠ¤ìº”",
      "ë§ë§‰ ìŠ¤ìº”",
      "ë³´ì•ˆ ì¹´ë©”ë¼",
      "ì—­ì£¼í–‰",
      "ì´ˆëŒ€ë°›ì§€ ì•Šì€ ì†ë‹˜",
      "ì¡°ì»¤ ì¹´ë“œ",
      "ê· í˜•",
      "í™˜ê¸°êµ¬",
      "ì†ŒìŒ ê°ì§€ ì„¼ì„œ",
      "ì •ì „"
    ];

    const CARD_DESC = {
      "ë ˆì´ì € íŠ¸ë¦½ì™€ì´ì–´":
`ë¼ìš´ë“œ 2ì˜ ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œì— J, Q, K ì¤‘ ì–´ëŠ ê²ƒë„ ì—†ë‹¤ë©´ ë‹¤ìŒ íš¨ê³¼ê°€ ë°œìƒí•œë‹¤.
ë¼ìš´ë“œ 1ì—ì„œ ê°€ì¥ ë†’ì€ ê°€ì¹˜ì˜ í°ìƒ‰ ì¹©ì„ ê°€ì§„ í”Œë ˆì´ì–´ëŠ” ìì‹ ì˜ í¬ì¼“ ì¹´ë“œë¥¼ ëª¨ë‘ ì•ë©´ì´ ë³´ì´ì§€ ì•Šê²Œ ë²„ë¦° ë’¤, ë±ì—ì„œ ìƒˆë¡œìš´ í¬ì¼“ ì¹´ë“œë¥¼ ë‹¤ì‹œ ë½‘ì•„ì•¼ í•œë‹¤.`,

      "ë§ˆìŠ¤í„° í‚¤":
`ì¡°ì»¤ ì¹´ë“œ 1ì¥ì´ ë±ì— ì¶”ê°€ëœë‹¤.
(ì¡°ì»¤ ì¹´ë“œëŠ” ë§Œë“¤ ìˆ˜ ìˆëŠ” ê°€ì¥ ë†’ì€ ì¡±ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•­ìƒ ìš°ì„  ì ìš©ëœë‹¤.)`,

      "ëª¨ì…˜ ê°ì§€ê¸°":
`ë¼ìš´ë“œ 2ì˜ ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ ì¤‘ í•˜ë‚˜ë¼ë„ J, Q, K ì¤‘ í•˜ë‚˜ë¼ë©´ ë‹¤ìŒ íš¨ê³¼ê°€ ë°œìƒí•œë‹¤.
ë¼ìš´ë“œ 1ì—ì„œ í°ìƒ‰ 1ì„± ì¹©ì„ ê°€ì§„ í”Œë ˆì´ì–´ëŠ” ìì‹ ì˜ í¬ì¼“ ì¹´ë“œë¥¼ ëª¨ë‘ ì•ë©´ì´ ë³´ì´ì§€ ì•Šê²Œ ë²„ë¦° ë’¤, ë±ì—ì„œ ìƒˆë¡œìš´ í¬ì¼“ ì¹´ë“œë¥¼ ë‹¤ì‹œ ë½‘ì•„ì•¼ í•œë‹¤.`,

      "ë¶ˆì²­ê° 2":
`4ë¼ìš´ë“œì— ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 1ì¥ì´ ì¶”ê°€ë¡œ ê³µê°œëœë‹¤.
(ì—­ì£¼í–‰ê³¼ í•¨ê»˜ ì‚¬ìš©ë  ê²½ìš°, 2ë¼ìš´ë“œì— ê³µê°œëœë‹¤.)`,

      "ì§€ë¬¸ ìŠ¤ìº”":
`ê°€ì¥ ë†’ì€ ê°€ì¹˜ì˜ ë¹¨ê°„ ì¹©ì„ ê°€ì§„ í”Œë ˆì´ì–´ê°€ ì‡¼ë‹¤ìš´ì—ì„œ ìì‹ ì˜ íŒ¨ë¥¼ ê³µê°œí•˜ê¸° ì „ì— ë°œë™í•œë‹¤.
ë‹¤ë¥¸ ëª¨ë“  í”Œë ˆì´ì–´ëŠ” ê·¸ í”Œë ˆì´ì–´ì˜ íŒ¨ ì¡±ë³´ê°€ ë¬´ì—‡ì¼ì§€ í•˜ë‚˜ë¡œ í•©ì˜í•´ì•¼ í•œë‹¤.
ë§Œì•½ ê·¸ ì¶”ì¸¡ì´ í‹€ë¦¬ë©´, ì´ë²ˆ í•˜ì´ìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•œë‹¤.`,

      "ë§ë§‰ ìŠ¤ìº”":
`ê°€ì¥ ë†’ì€ ê°€ì¹˜ì˜ ë¹¨ê°„ ì¹©ì„ ê°€ì§„ í”Œë ˆì´ì–´ê°€ ì‡¼ë‹¤ìš´ì—ì„œ ìì‹ ì˜ íŒ¨ë¥¼ ê³µê°œí•˜ê¸° ì „ì— ë°œë™í•œë‹¤.
ë‹¤ë¥¸ ëª¨ë“  í”Œë ˆì´ì–´ëŠ” ê·¸ í”Œë ˆì´ì–´ì˜ í¬ì¼“ ì¹´ë“œì— í¬í•¨ë˜ì–´ ìˆë‹¤ê³  ìƒê°í•˜ëŠ” ì¹´ë“œ ê°’(2ë¶€í„° Aê¹Œì§€) í•˜ë‚˜ë¥¼ í•©ì˜í•´ ì„ íƒí•œë‹¤.
ë§Œì•½ ê·¸ ì¶”ì¸¡ì´ í‹€ë¦¬ë©´, ì´ë²ˆ í•˜ì´ìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•œë‹¤.`,

      "ë³´ì•ˆ ì¹´ë©”ë¼":
`í¬ì¼“ ì¹´ë“œê°€ ë¶„ë°°ëœ ì§í›„ ì¦‰ì‹œ ë°œë™í•œë‹¤.
ëª¨ë“  í”Œë ˆì´ì–´ëŠ” í¬ì¼“ ì¹´ë“œ 1ì¥ì„ ì¶”ê°€ë¡œ ë°›ëŠ”ë‹¤.
ê° í”Œë ˆì´ì–´ëŠ” ì´ 3ì¥ì˜ í¬ì¼“ ì¹´ë“œë¡œ ê²Œì„ì„ ì§„í–‰í•œë‹¤.`,

      "ì—­ì£¼í–‰":
`í”Œë¡­, í„´, ë¦¬ë²„ì˜ ê³µê°œ ìˆœì„œê°€ ì—­ìˆœìœ¼ë¡œ ì§„í–‰ëœë‹¤.
2ë¼ìš´ë“œì— ì¹´ë“œ 1ì¥, 3ë¼ìš´ë“œì— ì¹´ë“œ 1ì¥, 4ë¼ìš´ë“œì— ì¹´ë“œ 3ì¥ì´ ê³µê°œëœë‹¤.`,

      "ì´ˆëŒ€ë°›ì§€ ì•Šì€ ì†ë‹˜":
`3ë¼ìš´ë“œì— ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 1ì¥ì´ ì¶”ê°€ë¡œ ê³µê°œëœë‹¤.`,

      "ì¡°ì»¤ ì¹´ë“œ":
`ì¡°ì»¤ì¹´ë“œë¥¼ ì¶”ê°€í•˜ê³  ì»¤ë®¤ë‹ˆí‹°ì— ê³µê°œë˜ë©´ ì¡°ì»¤ ëŒ€ì‹  ì¹´ë“œ ë‘ ì¥ì´ ë†“ì—¬ì§„ë‹¤.
ê°ì ê·¸ ë‘ ê°œì˜ ì¹´ë“œ ì¤‘ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê°€ì¥ ë†’ì€ ì¡±ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œ ê°œì˜ ì¹´ë“œë§Œ ê³¨ë¼ ì ìš©í•œë‹¤.
í¬ì¼“ ì¹´ë“œì— ì˜¨ë‹¤ë©´ ì¡°ì»¤ ëŒ€ì‹  ë±ì—ì„œ ë‘ ê°œì˜ ì¹´ë“œë¥¼ ë½‘ê³  í•˜ë‚˜ë¥¼ ê³ ë¥¸ë‹¤.`,

      "ê· í˜•":
`ë¼ìš´ë“œ 1ì—ì„œëŠ” í¬ì¼“ ì¹´ë“œ 1ì¥ë§Œ ë°›ëŠ”ë‹¤.
ë‚˜ë¨¸ì§€ í¬ì¼“ ì¹´ë“œë“¤ì€ ë¼ìš´ë“œ 2ì—ì„œ ë°›ëŠ”ë‹¤.`,

      "í™˜ê¸°êµ¬":
`í¬ì¼“ ì¹´ë“œê°€ ë¶„ë°°ëœ ì§í›„ ì¦‰ì‹œ ë°œë™í•œë‹¤.
ë¼ìš´ë“œ 1, 2, 3ì—ì„œ ê°€ì¥ ë†’ì€ ê°€ì¹˜ì˜ ì¹©ì„ ëª¨ë‘ ë’·ë©´(ì–´ë‘ìš´ ë©´)ìœ¼ë¡œ ë’¤ì§‘ëŠ”ë‹¤.
ì´ ì¹©ë“¤ì€ í…Œì´ë¸” ì¤‘ì•™ì—ì„œ ê°€ì ¸ê°„ ì´í›„ì—ëŠ” ì†Œìœ ìê°€ ë°”ë€” ìˆ˜ ì—†ë‹¤.`,

      "ì†ŒìŒ ê°ì§€ ì„¼ì„œ":
`í¬ì¼“ ì¹´ë“œê°€ ë¶„ë°°ëœ ì§í›„ ì¦‰ì‹œ ë°œë™í•œë‹¤.
ë¼ìš´ë“œ 1, 2, 3ì˜ 1ì„± ì¹©ì„ ëª¨ë‘ ë’·ë©´(ì–´ë‘ìš´ ë©´)ìœ¼ë¡œ ë’¤ì§‘ëŠ”ë‹¤.
ì´ ì¹©ë“¤ì€ í…Œì´ë¸” ì¤‘ì•™ì—ì„œ ê°€ì ¸ê°„ ì´í›„ì—ëŠ” ì†Œìœ ìê°€ ë°”ë€” ìˆ˜ ì—†ë‹¤.`,

      "ì •ì „":
`ë¼ìš´ë“œ 2 ì‹œì‘ ì‹œ: ëª¨ë“  í”Œë ˆì´ì–´ëŠ” ë¼ìš´ë“œ 1ì˜ ì¹©ì„ ë²„ë¦°ë‹¤.
ë¼ìš´ë“œ 3 ì‹œì‘ ì‹œ: ëª¨ë“  í”Œë ˆì´ì–´ëŠ” ë¼ìš´ë“œ 2ì˜ ì¹©ì„ ë²„ë¦°ë‹¤.
ë¼ìš´ë“œ 4 ì‹œì‘ ì‹œ: ëª¨ë“  í”Œë ˆì´ì–´ëŠ” ë¼ìš´ë“œ 3ì˜ ì¹©ì„ ë²„ë¦°ë‹¤.`
    };

    // ===== ìŠ¬ë¡¯ ì„¤ì • =====
    const ITEM_HEIGHT = 50;
    const SELECTOR_TOP = 50;
    const REPEAT = 120;
    const BASE_SPEED_PX_PER_SEC = 260;

    // ===== ì—˜ë¦¬ë¨¼íŠ¸ =====
    const reel = document.getElementById("reel");
    const statusEl = document.getElementById("timer");
    const descBox = document.getElementById("desc");
    const pickedListEl = document.getElementById("pickedList");
    const soundBtn = document.getElementById("soundBtn");

    const scoreRowsEl = document.getElementById("scoreRows");
    const sortedListEl = document.getElementById("sortedList");
    const successValEl = document.getElementById("successVal");
    const failValEl = document.getElementById("failVal");

    // ===== ìƒíƒœ =====
    let pool = [];
    let started = false;
    let spinning = false;

    let pickedHistory = [];

    // RAF loop
    let rafId = null;
    let lastT = null;
    let offsetY = 0;

    // ===== ì‚¬ìš´ë“œ =====
    let audioCtx = null;
    let soundOn = true;
    let tickInterval = null;

    function ensureAudio() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === "suspended") audioCtx.resume();
    }

    function playTick() {
      if (!soundOn) return;
      ensureAudio();
      const t0 = audioCtx.currentTime;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = "square";
      osc.frequency.setValueAtTime(880, t0);
      gain.gain.setValueAtTime(0.0001, t0);
      gain.gain.exponentialRampToValueAtTime(0.10, t0 + 0.005);
      gain.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.045);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start(t0);
      osc.stop(t0 + 0.05);
    }

    function playSelect() {
      if (!soundOn) return;
      ensureAudio();
      const t0 = audioCtx.currentTime;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = "sine";
      osc.frequency.setValueAtTime(880, t0);
      osc.frequency.exponentialRampToValueAtTime(1320, t0 + 0.08);

      gain.gain.setValueAtTime(0.0001, t0);
      gain.gain.exponentialRampToValueAtTime(0.18, t0 + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.18);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start(t0);
      osc.stop(t0 + 0.2);
    }

    function startSpinSound() {
      if (!soundOn) return;
      ensureAudio();
      stopSpinSound();
      tickInterval = setInterval(playTick, 120);
    }
    function stopSpinSound() {
      if (tickInterval) { clearInterval(tickInterval); tickInterval = null; }
    }

    function toggleSound() {
      soundOn = !soundOn;
      soundBtn.textContent = soundOn ? "ğŸ”Š ì‚¬ìš´ë“œ ON" : "ğŸ”‡ ì‚¬ìš´ë“œ OFF";
      if (!soundOn) stopSpinSound();
      saveState();
    }

    // ====== ì ìˆ˜íŒ + ì¹´ìš´í„° ìƒíƒœ(localStorage) ======
    const STORAGE_KEY = "challenge_card_app_state_v1";

    let scoreRows = [
      { name: "ê¹€ì¤€ìˆ˜", score: 1 },
      { name: "í”Œë ˆì´ì–´2", score: 0 },
      { name: "í”Œë ˆì´ì–´3", score: 0 }
    ];
    let counters = { success: 0, fail: 0 };

    function saveState() {
      const data = {
        soundOn,
        scoreRows,
        counters,
        pickedHistory
      };
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch (e) {}
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);

        if (typeof data.soundOn === "boolean") soundOn = data.soundOn;
        if (Array.isArray(data.scoreRows)) scoreRows = data.scoreRows;
        if (data.counters && typeof data.counters === "object") counters = data.counters;
        if (Array.isArray(data.pickedHistory)) pickedHistory = data.pickedHistory;

      } catch (e) {}
    }

    // ====== ì ìˆ˜íŒ ë Œë”/ì •ë ¬ ======
    function renderScoreRows() {
      scoreRowsEl.innerHTML = "";

      scoreRows.forEach((row, idx) => {
        const wrap = document.createElement("div");
        wrap.className = "scoreRow";

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "ì´ë¦„";
        nameInput.value = row.name ?? "";
        nameInput.addEventListener("input", (e) => {
          scoreRows[idx].name = e.target.value;
          renderSortedScores();
          saveState();
        });

        const scoreInput = document.createElement("input");
        scoreInput.type = "number";
        scoreInput.placeholder = "ì ìˆ˜";
        scoreInput.value = Number.isFinite(row.score) ? row.score : 0;
        scoreInput.addEventListener("input", (e) => {
          const v = parseInt(e.target.value, 10);
          scoreRows[idx].score = Number.isFinite(v) ? v : 0;
          renderSortedScores();
          saveState();
        });

        const del = document.createElement("button");
        del.className = "delBtn";
        del.textContent = "Ã—";
        del.title = "ì‚­ì œ";
        del.addEventListener("click", () => {
          scoreRows.splice(idx, 1);
          renderScoreRows();
          renderSortedScores();
          saveState();
        });

        wrap.appendChild(nameInput);
        wrap.appendChild(scoreInput);
        wrap.appendChild(del);

        scoreRowsEl.appendChild(wrap);
      });

      renderSortedScores();
    }

    function renderSortedScores() {
      sortedListEl.innerHTML = "";

      const filtered = scoreRows
        .map(r => ({ name: (r.name ?? "").trim(), score: parseInt(r.score, 10) || 0 }))
        .filter(r => r.name.length > 0);

      filtered.sort((a, b) => b.score - a.score || a.name.localeCompare(b.name));

      if (filtered.length === 0) {
        const empty = document.createElement("div");
        empty.style.opacity = "0.75";
        empty.style.fontSize = "13px";
        empty.textContent = "í‘œì‹œí•  ì¸ì›ì´ ì—†ìŠµë‹ˆë‹¤.";
        sortedListEl.appendChild(empty);
        return;
      }

      filtered.forEach(r => {
        const item = document.createElement("div");
        item.className = "sortedItem";

        const name = document.createElement("div");
        name.className = "sortedName";
        name.textContent = r.name;

        const score = document.createElement("div");
        score.className = "sortedScore";
        score.textContent = r.score;

        item.appendChild(name);
        item.appendChild(score);
        sortedListEl.appendChild(item);
      });
    }

    function addScoreRow() {
      scoreRows.push({ name: "", score: 0 });
      renderScoreRows();
      saveState();
    }

    // ===== ì„±ê³µ/ì‹¤íŒ¨ ì¹´ìš´í„° =====
    function renderCounters() {
      successValEl.textContent = counters.success;
      failValEl.textContent = counters.fail;
    }

    function incCounter(kind, delta) {
      if (kind !== "success" && kind !== "fail") return;
      const next = (counters[kind] || 0) + delta;
      counters[kind] = Math.max(0, next);
      renderCounters();
      saveState();
    }

    // ===== ì˜¤ë¥¸ìª½: ë½‘íŒ ì¹´ë“œ í˜„í™© =====
    function renderPickedList() {
      pickedListEl.innerHTML = "";

      if (pickedHistory.length === 0) {
        const empty = document.createElement("div");
        empty.style.opacity = "0.75";
        empty.style.fontSize = "13px";
        empty.textContent = "ì•„ì§ ë½‘íŒ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.";
        pickedListEl.appendChild(empty);
        return;
      }

      for (const title of pickedHistory) {
        const box = document.createElement("div");
        box.className = "pickedItem";

        const t = document.createElement("div");
        t.className = "pickedTitle";
        t.textContent = title;

        const d = document.createElement("div");
        d.className = "pickedDesc";
        d.textContent = CARD_DESC[title] || "";

        box.appendChild(t);
        box.appendChild(d);

        box.addEventListener("click", () => {
          d.style.display = (d.style.display === "block") ? "none" : "block";
        });

        pickedListEl.appendChild(box);
      }
    }

    // ===== ìŠ¬ë¡¯ UI/ë¡œì§ =====
    function buildReel() {
      reel.innerHTML = "";
      for (let i = 0; i < REPEAT; i++) {
        for (const name of CARDS) {
          const div = document.createElement("div");
          div.className = "item";
          div.textContent = name;
          reel.appendChild(div);
        }
      }
      offsetY = 0;
      reel.style.transform = "translateY(0px)";
    }

    function showOnlyPicked(picked) {
      reel.innerHTML = `
        <div class="item ghost">&nbsp;</div>
        <div class="item" style="visibility:visible;">${picked}</div>
        <div class="item ghost">&nbsp;</div>
      `;
      offsetY = 0;
      reel.style.transform = "translateY(0px)";
    }

    function updateRemain() {
      document.getElementById("remain").textContent =
        `ë‚¨ì€ ì¹´ë“œ ìˆ˜: ${pool.length}`;
    }

    function stopRaf() {
      if (rafId) cancelAnimationFrame(rafId);
      rafId = null;
      lastT = null;
    }

    function loop(t) {
      if (!spinning) return;

      if (lastT == null) lastT = t;
      const dt = (t - lastT) / 1000;
      lastT = t;

      offsetY -= BASE_SPEED_PX_PER_SEC * dt;

      const cycleH = CARDS.length * ITEM_HEIGHT;
      if (offsetY <= -cycleH) offsetY += cycleH;

      reel.style.transform = `translateY(${offsetY}px)`;
      rafId = requestAnimationFrame(loop);
    }

    function startGame() {
      ensureAudio();

      pool = [...CARDS];
      started = true;
      spinning = false;
      stopRaf();
      stopSpinSound();

      // ì¹´ë“œ í˜„í™©ì€ ìœ ì§€í•˜ê³  ì‹¶ìœ¼ë©´ ì•„ë˜ 2ì¤„ ì£¼ì„ ì²˜ë¦¬í•˜ë©´ ë¨
      pickedHistory = [];
      renderPickedList();

      statusEl.textContent = "";
      descBox.style.display = "none";
      descBox.textContent = "";

      buildReel();
      updateRemain();
      saveState();
    }

    function endGame() {
      started = false;
      pool = [];
      spinning = false;
      stopRaf();
      stopSpinSound();

      statusEl.textContent = "";
      descBox.style.display = "none";
      descBox.textContent = "";

      reel.innerHTML = "";
      document.getElementById("remain").textContent = "";

      // ì¢…ë£Œí•´ë„ í˜„í™© ìœ ì§€í•˜ê³  ì‹¶ìœ¼ë©´ ì£¼ì„ ì²˜ë¦¬
      pickedHistory = [];
      renderPickedList();

      saveState();
    }

    function startSpin() {
      ensureAudio();

      if (!started) { alert("ë¨¼ì € ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”"); return; }
      if (spinning) return;
      if (pool.length === 0) return;

      buildReel();

      descBox.style.display = "none";
      descBox.textContent = "";

      spinning = true;
      statusEl.textContent = "ëŒì•„ê°€ëŠ” ì¤‘â€¦ ìŠ¤íƒ‘ì„ ëˆŒëŸ¬!";
      stopRaf();
      rafId = requestAnimationFrame(loop);

      startSpinSound();
    }

    function stopSpin() {
      ensureAudio();

      if (!started) return;
      if (!spinning) return;

      spinning = false;
      stopRaf();
      stopSpinSound();

      const i = Math.floor((SELECTOR_TOP - offsetY) / ITEM_HEIGHT);

      const N = CARDS.length;
      const visibleIndex = ((i % N) + N) % N;
      const candidate = CARDS[visibleIndex];

      let picked = candidate;
      let shift = 0;
      while (!pool.includes(picked) && shift < N) {
        shift++;
        picked = CARDS[(visibleIndex + shift) % N];
      }

      if (!pool.includes(picked)) {
        statusEl.textContent = "ë‚¨ì€ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤";
        return;
      }

      pool = pool.filter(x => x !== picked);

      statusEl.textContent = "ì„ íƒ ì™„ë£Œ";
      showOnlyPicked(picked);

      descBox.textContent = CARD_DESC[picked] || "";
      descBox.style.display = "block";

      playSelect();

      pickedHistory.push(picked);
      renderPickedList();

      updateRemain();
      saveState();
    }

    // ===== ì´ˆê¸° ë¡œë”© =====
    loadState();

    // ì´ˆê¸° UI ë°˜ì˜
    soundBtn.textContent = soundOn ? "ğŸ”Š ì‚¬ìš´ë“œ ON" : "ğŸ”‡ ì‚¬ìš´ë“œ OFF";
    renderScoreRows();
    renderCounters();
    renderPickedList();

    // ë©”ì¸ ê²Œì„ ìƒíƒœ(í’€)ëŠ” ìƒˆë¡œê³ ì¹¨ ì‹œ í•­ìƒ ì´ˆê¸°í™”(ì›í•˜ë©´ ì €ì¥ë„ ê°€ëŠ¥)
    pool = [...CARDS];
    started = true;
    buildReel();
    updateRemain();
  </script>
</body>
</html>
